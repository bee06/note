## String
### 了解下String类型的内存消耗的问题以及选择节省内存开销的数据类型的解决方案

string 类型就会用简单动态字符串(SDS):
* buf: 字节数组，保存实际数据
* len: 占4个字节，表示buf的已用长度
* alloc: 占4个字节，表示buf的实际分配长度

buf保存了实际数据，len和alloc本身其实是SDS结构体的额外开销
除了SDS的额外开销，还有一个来自于RedisObject结构体的开销
因为Redis的数据类型有很多，而且，不同的数据类型都有相同的元数据要记录（比如说最后一次访问的时间、被引用的次数等）
所以，Redis会用一个RedisObject结构体来统一记录这些元数据，同时指向实际数据。

一个RedisObject包含了8字节的元数据和一个8字节指针，这个指针再进一步指向具体数据类型的实际所在。
为了节省内存空间，Redis 还对 Long 类型整数和 SDS 的内存布局做了专门的设计。
一方面，当保存的是 Long 类型整数时，RedisObject 中的指针就直接赋值为整数数据了，这样就不用额外的指针再指向整数了，节省了指针的空间开销。
另一方面，当保存的是字符串数据，并且字符串小于等于 44 字节时，RedisObject 中的元数据、指针和 SDS 是一块连续的内存区域，这样就可以避免内存碎片。这种布局方式也被称为 embstr 编码方式。

当然，当字符串大于 44 字节时，SDS 的数据量就开始变多了，Redis 就不再把 SDS 和 RedisObject 布局在一起了，而是会给 SDS 分配独立的空间，并用指针指向 SDS 结构。这种布局方式被称为 raw 编码模式。


